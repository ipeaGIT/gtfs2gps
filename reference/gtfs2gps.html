<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert GTFS to GPS-like data given a spatial resolution — gtfs2gps • gtfs2gps</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert GTFS to GPS-like data given a spatial resolution — gtfs2gps"><meta name="description" content="Convert GTFS data to GPS format by sampling points using a given
spatial resolution. This function creates additional points in order to
guarantee that two points in a same trip will have at most a given
distance, indicated as a spatial resolution. It is possible to use future package
to parallelize the execution (or use argument plan). This function also
uses progressr internally to show progress bars. See the example below on how
to show a progress bar while executing this function."><meta property="og:description" content="Convert GTFS data to GPS format by sampling points using a given
spatial resolution. This function creates additional points in order to
guarantee that two points in a same trip will have at most a given
distance, indicated as a spatial resolution. It is possible to use future package
to parallelize the execution (or use argument plan). This function also
uses progressr internally to show progress bars. See the example below on how
to show a progress bar while executing this function."><meta property="og:image" content="https://ipeagit.github.io/gtfs2gps/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gtfs2gps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1-2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/intro_to_gtfs2gps.html">gtfs2gps: Converting GTFS data to GPS-like format</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/gtfs2gps/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Convert GTFS to GPS-like data given a spatial resolution</h1>
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfs2gps/blob/master/R/gtfs2gps.R" class="external-link"><code>R/gtfs2gps.R</code></a></small>
      <div class="d-none name"><code>gtfs2gps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Convert GTFS data to GPS format by sampling points using a given
spatial resolution. This function creates additional points in order to
guarantee that two points in a same trip will have at most a given
distance, indicated as a spatial resolution. It is possible to use future package
to parallelize the execution (or use argument plan). This function also
uses progressr internally to show progress bars. See the example below on how
to show a progress bar while executing this function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gtfs2gps</span><span class="op">(</span></span>
<span>  <span class="va">gtfs_data</span>,</span>
<span>  spatial_resolution <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ncores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strategy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filepath <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  snap_method <span class="op">=</span> <span class="st">"nearest2"</span>,</span>
<span>  continue <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-gtfs-data">gtfs_data<a class="anchor" aria-label="anchor" href="#arg-gtfs-data"></a></dt>
<dd><p>A path to a GTFS file to be converted to GPS, or a GTFS data
represented as a list of data.tables.</p></dd>


<dt id="arg-spatial-resolution">spatial_resolution<a class="anchor" aria-label="anchor" href="#arg-spatial-resolution"></a></dt>
<dd><p>The spatial resolution in meters. Default is 100m.
This function only creates points in order to guarantee that the minimum
distance between two consecutive points will be at most the
spatial_resolution. If a given shape has two consecutive points with a
distance lower than the spatial resolution, the algorithm will not remove
such points.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Decides whether the function should run in parallel. Defaults is FALSE.
When TRUE, it will use all cores available minus one using future::plan() with
strategy "multisession" internally.
Note that it is possible to create your own plan before calling gtfs2gps().
In this case, do not use this argument.</p></dd>


<dt id="arg-ncores">ncores<a class="anchor" aria-label="anchor" href="#arg-ncores"></a></dt>
<dd><p>Number of cores to be used in parallel execution. When
`parallel = FALSE`, this argument is ignored. When `parallel = TRUE`,
then by default the function uses all available cores minus one.</p></dd>


<dt id="arg-strategy">strategy<a class="anchor" aria-label="anchor" href="#arg-strategy"></a></dt>
<dd><p>This argument is deprecated. Please use argument plan instead or
use future::plan() directly.</p></dd>


<dt id="arg-filepath">filepath<a class="anchor" aria-label="anchor" href="#arg-filepath"></a></dt>
<dd><p>Output file path. As default, the output is returned when gtfs2gps finishes.
When this argument is set, each route is saved into a txt file within filepath,
with the name equals to its id. In this case, no output is returned. See argument
compress for another option.</p></dd>


<dt id="arg-compress">compress<a class="anchor" aria-label="anchor" href="#arg-compress"></a></dt>
<dd><p>Argument that can be used only with filepath. When TRUE, it
compresses the output files by saving them using rds format. Default value is FALSE.
Note that compress guarantees that the data saved will be read in the same way as it
was created in R. If not compress, the txt extension requires the data to be converted
from ITime to string, and therefore they need to manually converted back to ITime to
be properly handled by gtfs2gps.</p></dd>


<dt id="arg-snap-method">snap_method<a class="anchor" aria-label="anchor" href="#arg-snap-method"></a></dt>
<dd><p>The method used to snap stops to the route geometry. There
are two available methods: `nearest1` and `nearest2`. Defaults to
`nearest2`. See details for more info.</p></dd>


<dt id="arg-continue">continue<a class="anchor" aria-label="anchor" href="#arg-continue"></a></dt>
<dd><p>Argument that can be used only with filepath. When TRUE, it
skips processing the shape identifiers that were already saved into
files. It is useful to continue processing a GTFS file that was stopped
for some reason. Default value is FALSE.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Hide messages while processing the data? Defaults to FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A `data.table`, where each row represents a GPS point. The following
columns are returned (units of measurement in parenthesis): dist and cumdist
(meters), cumtime (seconds), shape_pt_lon and shape_pt_lat (degrees), speed
(km/h), timestamp (hh:mm:ss).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>After creating geometry points for a given shape id, the `gtfs2gps()`
function snaps the stops to the route geometry. Two strategies are implemented
to do this.
- The `nearest2` method (default) triangulates the distance between each stop
and the two nearest points in the route geometry to decide which point the
stop should be snapped to. If there is any stop that is further away to the
route geometry  than `spatial_resolution`, the algorithm recursively doubles
the `spatial_resolution` to do the search/snap of all stops.
- The `nearest1` method traverses the geometry points computing their
distances to the first stop. Whenever it finds a distance to the stop smaller
than `spatial_resolution`, then the stop will be snapped to such point. The
algorithm then applies the same strategy to the next stop until the vector of
stops end.</p>
<p>The `speed`, `cumdist`, and `cumtime` are based on the difference of distance
and time between the current and previous row of the same trip. It means that
the first data point at the first stop of each trip represens a stationary
vehicle. The `adjust_speed()` function can be used to post-process the output
to replace eventual `NA` values in the `speed` column.</p>
<p>Each stop is presented as two data points for each trip in the output. The
`timestamp` value in the first data point represents the time when the
vehicle arrived at that stop (corresponding the `arrival_time` column in the
`stop_times.txt` file), while the `timestamp` in the second data point
represents the time when the vehicle departured from that stop (corresponding
the `departure_time` column in the `stop_times.txt` file). The second point
considers that the vehicle is stationary at the stop, immediately before
departing.</p>
<p>Some GTFS feeds do not report embark/disembark times (so `arrival_time` and
`departure_time` are identical at the same stop). In this case, the user can
call the `adjust_arrival_departure()` function to set the minimum time each
vehicle will spend at stops to embark/disembark passengers.</p>
<p>To avoid division by zero, the minimum speed of vehicles in the output is
1e-12 Km/h, so that vehicles are never completely stopped.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/gtfs2gps" class="external-link">gtfs2gps</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/poa.zip"</span>, package <span class="op">=</span> <span class="st">"gtfs2gps"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">gtfstools</span><span class="fu">::</span><span class="fu"><a href="https://ipeagit.github.io/gtfstools/reference/filter_by_shape_id.html" class="external-link">filter_by_shape_id</a></span><span class="op">(</span><span class="st">"T2-1"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="filter_single_trip.html">filter_single_trip</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Unzipped the following files to /tmp/RtmpVbDcru/gtfsio:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * agency.txt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * calendar.txt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * routes.txt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * shapes.txt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * stop_times.txt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * stops.txt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * trips.txt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading agency</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading calendar</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading routes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading shapes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading stop_times</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading stops</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading trips</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="va">poa_gps</span> <span class="op">&lt;-</span> <span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="fu">gtfs2gps</span><span class="op">(</span><span class="va">gtfs</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rafael H. M. Pereira, Pedro R. Andrade, Joao Bazzo, Ipea - Institue for Applied Economic Research.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

